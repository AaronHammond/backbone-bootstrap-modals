/*!
  backbone-bootstrap-modals 0.1.0
  Licensed under the MIT license.
*/
!function(a){"use strict";var b={};b.BaseHeaderView=Backbone.View.extend({className:"modal-header",initialize:function(a){var b=a||{};this.label=b.label||"",this.labelId=b.labelId||"myModalLabel",this.showClose=void 0!==b.showClose?b.showClose:!0},render:function(){var a="";return this.showClose&&(a+='<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>'),a+='<h4 id="'+this.labelId+'" class="modal-title">'+this.label+"</h4>",this.$el.html(a),this}}),b.BaseBodyView=Backbone.View.extend({className:"modal-body",initialize:function(a){var b=a||{};this.text=b.text},render:function(){var a="";return this.text&&(a+="<p>"+this.text+"</p>"),this.$el.html(a),this}}),b.BaseFooterView=Backbone.View.extend({className:"modal-footer",initialize:function(a){var b=a||{};this.buttons=b.buttons||[]},render:function(){function a(a){var b=a.attributes||{},c=Object.keys(b).map(function(a){return a+'="'+b[a]+'"'}).join(" "),d="<button";return a.id&&(d+=' id="'+a.id+'"'),a.className&&(d+=' class="'+a.className+'"'),c&&(d+=c),d+=">",a.value&&(d+=a.value),d+="</button>"}var b=this.buttons.map(a).join("");return this.$el.html(b),this}}),b.BaseModal=Backbone.View.extend({className:"modal",attributes:{tabindex:"-1",role:"dialog","aria-labelledby":"myModalLabel"},bootstrapModalEvents:{"show.bs.modal":"onShowBsModal","shown.bs.modal":"onShownBsModal","hide.bs.modal":"onHideBsModal","hidden.bs.modal":"onHiddenBsModal"},headerView:b.BaseHeaderView,bodyView:b.BaseBodyView,footerView:b.BaseFooterView,modalOptions:{backdrop:!0,keyboard:!0},initialize:function(a){var b=a||{};this.shown=!1,b.modalOptions&&(this.modalOptions=b.modalOptions),this.initializeSubviews(b)},initializeSubviews:function(a){this.headerViewInstance=this.buildSubview(this.getHeaderView(a),this.getSubviewOptions("headerViewOptions",a)),this.bodyViewInstance=this.buildSubview(this.getBodyView(a),this.getSubviewOptions("bodyViewOptions",a)),this.footerViewInstance=this.buildSubview(this.getFooterView(a),this.getSubviewOptions("footerViewOptions",a))},getHeaderView:function(a){return a.headerView?a.headerView:this.headerView},getBodyView:function(a){return a.bodyView?a.bodyView:this.bodyView},getFooterView:function(a){return a.footerView?a.footerView:this.footerView},getSubviewOptions:function(a,b){var c=_.result(this,a);return b[a]&&(c=_.result(b,a)),c},buildSubview:function(a,b){if(!a)throw new Error("view not specified");var c=_.extend({model:this.model,collection:this.collection},b);return new a(c)},delegateEvents:function(a){var b=a||_.result(this,"events")||{};_.each(this.getAdditionalEventsToDelegate(),function(a){_.extend(b,a)}),Backbone.View.prototype.delegateEvents.call(this,b)},getAdditionalEventsToDelegate:function(){return[this.bootstrapModalEvents]},render:function(){this.$el.html(['<div class="modal-dialog">','<div class="modal-content">',"</div>","</div>"].join(""));var a=this.$el.find(".modal-content");return this.headerView&&a.append(this.headerViewInstance.render().$el),this.bodyView&&a.append(this.bodyViewInstance.render().$el),this.footerView&&a.append(this.footerViewInstance.render().$el),this.shown||this.modalOptions.show===!1||this.$el.modal(this.modalOptions),this},remove:function(){return this.removeSubviews(),Backbone.View.prototype.remove.apply(this,arguments)},removeSubviews:function(){this.headerView&&this.removeSubview(this.headerViewInstance),this.bodyView&&this.removeSubview(this.bodyViewInstance),this.footerView&&this.removeSubview(this.footerViewInstance)},removeSubview:function(a){Backbone.Marionette&&a.close?a.close.apply(a):a.remove&&a.remove.apply(a)},show:function(){this.$el.modal("show")},hide:function(){this.$el.modal("hide")},onShowBsModal:function(){},onShownBsModal:function(){this.shown=!0},onHideBsModal:function(){},onHiddenBsModal:function(){this.shown=!1,this.remove()}}),b.ConfirmationModal=b.BaseModal.extend({confirmationEvents:{"click #confirmation-confirm-btn":"onClickConfirm"},headerViewOptions:function(){return{label:_.result(this,"label"),labelId:"myModalLabel",showClose:!0}},bodyViewOptions:function(){return{text:_.result(this,"text")}},footerViewOptions:function(){var a=[];return a.push({id:"confirmation-cancel-btn",className:"btn btn-default",value:_.result(this,"cancelText")||"Cancel",attributes:{"data-dismiss":"modal","aria-hidden":"true"}}),a.push({id:"confirmation-confirm-btn",className:"btn btn-primary",value:_.result(this,"confirmText")||"Confirm"}),{buttons:a}},initialize:function(a){var c=a||{};c.label&&(this.label=c.label),c.text&&(this.text=c.text),c.confirmText&&(this.confirmText=c.confirmText),c.cancelText&&(this.cancelText=c.cancelText),c.hideCancel&&(this.showCancel=c.showCancel),c.onConfirm&&(this.onConfirm=c.onConfirm),b.BaseModal.prototype.initialize.call(this,c)},getAdditionalEventsToDelegate:function(){var a=b.BaseModal.prototype.getAdditionalEventsToDelegate.call(this);return a.concat(this.confirmationEvents)},onClickConfirm:function(a){a.preventDefault(),a.currentTarget.disabled=!0,this.onConfirm?this.onConfirm.call(this,a)!==!1&&this.hide():this.hide()}}),b.WizardModal=b.BaseModal.extend({wizardEvents:{"click #confirmation-previous-btn":"onClickPrevious","click #confirmation-next-btn":"onClickNext"},getBodyView:function(){return this.currentStep.view},headerViewOptions:function(){return{label:this.currentStep.label,labelId:"myModalLabel",showClose:!0}},bodyViewOptions:function(){return this.currentStep.viewOptions},footerViewOptions:function(){var a=this.getButtonsForCurrentStep();return{buttons:a}},initialize:function(a){this.initializeSteps(a),this.setCurrentStep(0);var c={};c.modalOptions=a.modalOptions,b.BaseModal.prototype.initialize.call(this,c)},initializeSteps:function(a){if(a.stepGraph&&(this.stepGraph=a.stepGraph),!this.stepGraph||!_.isArray(this.stepGraph)||!this.stepGraph.length)throw new Error("steps array must be specified and non-empty")},setCurrentStep:function(a){this.currentStep=this.stepGraph[a]},getButtonsForCurrentStep:function(){var a=this.currentStep.previousIndex,b=this.currentStep.previousText||"Previous",c=(this.currentStep.nextIndex,this.currentStep.nextText||"Next"),d=[];return void 0!==a&&d.push({id:"confirmation-previous-btn",className:"btn btn-default",value:b}),d.push({id:"confirmation-next-btn",className:"btn btn-primary",value:c}),d},getAdditionalEventsToDelegate:function(){var a=b.BaseModal.prototype.getAdditionalEventsToDelegate.call(this);return a.concat(this.wizardEvents)},renderSubviews:function(){var a={};b.BaseModal.prototype.removeSubviews.call(this),b.BaseModal.prototype.initializeSubviews.call(this,a),this.render()},renderPreviousStep:function(){this.setCurrentStep(this.currentStep.previousIndex),this.renderSubviews()},renderNextStep:function(){var a=this.currentStep.nextIndex;void 0!==a?(this.setCurrentStep(a),this.renderSubviews()):this.hide()},onClickPrevious:function(a){a.preventDefault(),a.currentTarget.disabled=!0,this.renderPreviousStep()},onClickNext:function(a){a.preventDefault(),a.currentTarget.disabled=!0,this.currentStep.onNext&&this.currentStep.onNext.call(this,a)===!1||this.renderNextStep()}}),a.BackboneBootstrapModals=b}(this);