/*!
  backbone-bootstrap-modals 0.1.0
  Licensed under the MIT license.
*/
!function(a){"use strict";var b={};b.BaseModal=Backbone.View.extend({className:"modal",attributes:{tabindex:"-1",role:"dialog","aria-labelledby":"myModalLabel"},events:{"show.bs.modal":"onShowBsModal","shown.bs.modal":"onShownBsModal","hide.bs.modal":"onHideBsModal","hidden.bs.modal":"onHiddenBsModal"},defaultModalOptions:{backdrop:!0,keyboard:!0},initialize:function(a){var b=a||{};this.initializeSubViews(b),this.modalOptions=_.extend({},this.defaultModalOptions,b.modalOptions),this.shown=!1},initializeSubViews:function(a){this.initializeSubView("headerViewInstance","headerView","headerViewOptions",b.BaseHeaderView,a),this.initializeSubView("bodyViewInstance","bodyView","bodyViewOptions",b.BaseBodyView,a),this.initializeSubView("footerViewInstance","footerView","footerViewOptions",b.BaseFooterView,a)},initializeSubView:function(a,b,c,d,e){this[c]||(this[c]=e[c]),this[b]||(this[b]=e[b]?e[b]:d),this[a]=new this[b](this[c])},render:function(){this.$el.html(['<div class="modal-dialog">','<div class="modal-content">',"</div>","</div>"].join(""));var a=this.$el.find(".modal-content");return this.headerView&&a.append(this.headerViewInstance.render().$el),this.bodyView&&a.append(this.bodyViewInstance.render().$el),this.footerView&&a.append(this.footerViewInstance.render().$el),this.shown||this.modalOptions.show===!1||(this.$el.modal(this.modalOptions),this.shown=!0),this},remove:function(){return this.removeSubViews(),Backbone.View.prototype.remove.apply(this,arguments)},removeSubViews:function(){this.headerView&&this.removeSubView(this.headerViewInstance),this.bodyView&&this.removeSubView(this.bodyViewInstance),this.footerView&&this.removeSubView(this.footerViewInstance)},removeSubView:function(a){Backbone.Marionette&&a.close?a.close.apply(a):a.remove&&a.remove.apply(a)},show:function(){this.$el.modal("show")},hide:function(){this.$el.modal("hide")},onShowBsModal:function(){},onShownBsModal:function(){},onHideBsModal:function(){},onHiddenBsModal:function(){this.remove()}}),b.BaseHeaderView=Backbone.View.extend({className:"modal-header",initialize:function(a){var b=a||{};this.label=b.label||"",this.labelId=b.labelId||"myModalLabel",this.showClose=void 0!==b.showClose?b.showClose:!0},render:function(){var a="";return this.showClose&&(a+='<button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>'),a+='<h4 id="'+this.labelId+'" class="modal-title">'+this.label+"</h4>",this.$el.html(a),this}}),b.BaseBodyView=Backbone.View.extend({className:"modal-body",initialize:function(a){var b=a||{};this.text=b.text},render:function(){var a="";return this.text&&(a+="<p>"+this.text+"</p>"),this.$el.html(a),this}}),b.BaseFooterView=Backbone.View.extend({className:"modal-footer",initialize:function(a){var b=a||{};this.buttons=b.buttons||[]},render:function(){function a(a){var b=a.attributes||{},c=Object.keys(b).map(function(a){return a+'="'+b[a]+'"'}).join(" "),d="<button";return a.id&&(d+=' id="'+a.id+'"'),a.className&&(d+=' class="'+a.className+'"'),c&&(d+=c),d+=">",a.value&&(d+=a.value),d+="</button>"}var b=this.buttons.map(a).join("");return this.$el.html(b),this}}),b.ConfirmationModal=b.BaseModal.extend({events:{"click #confirmation-cancel-btn":"onClickCancel","click #confirmation-confirm-btn":"onClickConfirm"},defaultOptions:{headerViewOptions:{label:void 0,labelId:"myModalLabel",showClose:!0},bodyViewOptions:{text:void 0},footerViewOptions:{buttons:[{id:"confirmation-cancel-btn",className:"btn btn-default",value:"Cancel",attributes:{"data-dismiss":"modal","aria-hidden":"true"}},{id:"confirmation-confirm-btn",className:"btn btn-primary",value:"Confirm"}]}},initialize:function(a){var c=_.extend({},this.defaultOptions,a);c.headerViewOptions&&c.label&&(c.headerViewOptions.label=c.label),c.bodyViewOptions&&c.text&&(c.bodyViewOptions.text=c.text),this.onCancel=c.onCancel,this.onConfirm=c.onConfirm,b.BaseModal.prototype.initialize.call(this,c)},onClickCancel:function(a){a.preventDefault(),a.currentTarget.disabled=!0,this.executeCallbackAndHide(this.onConfirm)},onClickConfirm:function(a){a.preventDefault(),a.currentTarget.disabled=!0,this.executeCallbackAndHide(this.onConfirm)},executeCallbackAndHide:function(a){a?a.call()!==!1&&this.hide():this.hide()}}),b.WizardModal=b.BaseModal.extend({events:{"click #confirmation-previous-btn":"onClickPrevious","click #confirmation-next-btn":"onClickNext"},initialize:function(a){this.initializeSteps(a),this.setCurrentStep(0);var c=this.getOptionsForCurrentStep();c.modalOptions=_.extend({},this.defaultModalOptions,a.modalOptions),b.BaseModal.prototype.initialize.call(this,c)},initializeSteps:function(a){if(this.steps||(this.steps=a.steps),!a.steps||!_.isArray(a.steps)||!a.steps.length)throw new Error("steps array must be specified and non-empty")},setCurrentStep:function(a){this.currentStepIndex=a,this.currentStep=this.steps[this.currentStepIndex]},getPreviousStepIndex:function(){var a=this.currentStepIndex-1;return a>=0?a:void 0},getNextStepIndex:function(){return this.currentStepIndex+1},getOptionsForCurrentStep:function(){return{headerViewOptions:{label:this.currentStep.label,labelId:"myModalLabel",showClose:!0},bodyView:this.currentStep.view,bodyViewOptions:this.currentStep.viewOptions,footerViewOptions:{buttons:this.getButtonsForCurrentStep()}}},getButtonsForCurrentStep:function(){var a=this.currentStep.previousText||"Previous",b=this.currentStep.nextText||"Next",c=this.getPreviousStepIndex(),d=this.getNextStepIndex(),e=[];return c&&e.push({id:"confirmation-previous-btn",className:"btn btn-default",value:a}),d&&e.push({id:"confirmation-next-btn",className:"btn btn-primary",value:b}),e},onClickPrevious:function(a){a.preventDefault(),a.currentTarget.disabled=!0,this.setCurrentStep(this.getPreviousStepIndex()),this.renderCurrentStep()},onClickNext:function(a){if(a.preventDefault(),a.currentTarget.disabled=!0,!this.onNext||this.onNext.call()!==!1){var b=this.getNextStepIndex();b>this.steps.length?this.hide():(this.setCurrentStep(b),this.renderCurrentStep())}},renderCurrentStep:function(){var a=this.getOptionsForCurrentStep();b.BaseModal.prototype.removeSubViews.call(this),b.BaseModal.prototype.initializeSubViews.call(this,a),this.render()}}),a.BackboneBootstrapModals=b}(this);